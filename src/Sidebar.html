<html>
<head>
  
  <script src="//use.fontawesome.com/releases/v5.0.2/js/all.js"></script>
  <script src="//storage.googleapis.com/yamm-ressources/JS/saveSvgAsPng.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jscolor/2.0.4/jscolor.min.js"></script>
  <script src="//storage.googleapis.com/yamm-ressources/JS/tippy.min.js"></script>
  
  <link rel="stylesheet" href="//ssl.gstatic.com/docs/script/css/add-ons1.css">
  <link rel="stylesheet" href="//storage.googleapis.com/yamm-ressources/CSS/tippy.css">
  
  <!-- To use Material Design icons, we need a way to convert web font / <i> to png -->
  <!-- <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> -->
  
  <?!= HtmlService.createHtmlOutputFromFile('Sidebar_IconList.js').getContent(); ?>
  
  <style>
    html{
      overflow-y: scroll;
    }
    .header {
      position:fixed;
      top:0;
      
      width:100%;
      padding: 10px;
      box-sizing: border-box;
      
      z-index:100;
      
      background-color: white;
      border-bottom: 1px solid rgb(224, 224, 224)
    }
    .footer {
      display: none;
      position:fixed;
      
      bottom:0;
      width:100%;
      padding: 10px;
      
      z-index:100;
      
      background-color: rgb(97, 97, 97);
      color: white;
      font-weight: bold;
    }
    
    
    /*<editor-fold desc="# HEADER content">*/
    
    .left-label {
      display: flex;
      align-items: baseline;
    }
    .left-label:not(:last-child){
      margin-bottom:3px
    }
    .left-label>label{
      display:inline-block;
      width:50px;
    }
    .left-label>input {
      flex: auto;
    }
    
    /*</editor-fold>*/
    
    
    #icon-list{
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      
      margin-top: 74px;
      
      color: #f3b32a;
    }
  </style>

</head>
<body>
  <div class="header">
    <div class="left-label">
      <label for="color-picker">Color:</label>
      <input id="color-picker" type="text" class="jscolor">
    </div>
    <div class="left-label">
      <label for="filter">Search:</label>
      <input id="filter" type="text" placeholder="Search by icon name...">
    </div>
  </div>
  
  <div id="icon-list"></div>
  
  <div id="footer" class="footer">Adding icon to current slide...</div>
  
  <script>
    var self = {
      dom: {
        list: document.getElementById('icon-list'),
        colorPicker: document.getElementById('color-picker'),
        filter: document.getElementById('filter'),
        footer: document.getElementById('footer')
      },
      
      color: 'F3B32A',
      filter: ''
    };

    /**
     * Init and customize color picker
     */
    self.initColorPicker = function () {
      // Disable automatic lookup
      jscolor.lookupClass = null;
      
      // Set color
      this.dom.colorPicker.value = this.color;
      
      // Install now
      jscolor.installByClassName('jscolor');
  
      this.dom.colorPicker.jscolor.padding = 8;
      this.dom.colorPicker.jscolor.sliderSize = 8;
    };

    /**
     * Update display with new selected color
     *
     * @param {string} jsColor
     */
    self.onColorChange = function () {
      this.color = this.dom.colorPicker.jscolor.toString();
      
      // Apply color to the icon list
      this.dom.list.style.color = '#'+ this.color;
    };
    
    /**
     * On filter input key-up event, filter display if no input for 300ms
     */
    self.onFilterKeyUP = function () {
      // Fire filter if 300ms pass without input
      clearTimeout(this._filterDebouncer);
      this._filterDebouncer = setTimeout(this._onFilter, 300);
    };
    
    /**
     * Filter the display
     */
    self._onFilter = function () {
      this.filter = this.dom.filter.value;
      
      this.display.filter(this.filter);
    }.bind(self);
    
    
    /**
     * Insert Font Awesome icons
     *
     * @param {IconList} iconList
     */
    self.insertIcon_FA = function (iconList){
      var list = JSON.parse('<?= iconList ?>');
      
      for (var i = 0; i < list.length; i++) {
        var iconName = 'fa'+ list[i].t +'-'+ list[i].n;
        var html = '<i class="fa'+ list[i].t +' fa-'+ list[i].n +'"></i>';
        
        iconList.insertIcon(html, iconName, list[i].n, [list[i].n, list[i].a].join(','), list[i]);
      }
    };
    
    /**
     * Init the icon display
     * Loads all icons lists
     */
    self.initIconDisplay = function () {
      this.display = new IconDisplay(self.dom.list);
  
      this.display.addList('fa', this.insertIcon_FA);
      this.display.showList('fa');
    };
    
    
    /**
     * Start the app
     */
    self.init = function () {
      this.dom.colorPicker.addEventListener('change', this.onColorChange.bind(this));
      this.dom.filter.addEventListener('keyup', this.onFilterKeyUP.bind(this));
      
      this.initColorPicker();
      this.initIconDisplay();
      
      // Add tooltip display to show the icon's name
      tippy('.text-tooltip', {
        arrow: true,
        size: 'small'
      });
    };
    
    
    /* Start */
    self.init();
        
    
    
    /**
     * Convert the chosen SVG icon,
     * then send it to the server to insert it in the slide
     *
     * @param {HTMLDivElement} el
     */
    function addToSlide(el) {
      // Add proper color to icon
      var color = domList.style.color;
      var icon = el.childNodes[0];
      
      icon.style.color = color;
      svgAsPngUri(icon, {}, function(uri) {
        google.script.run.withSuccessHandler(onSuccess).addImageInCurrentPage(uri);
      });
      
      icon.style.color = "";
      document.getElementById("footer").style.display = "block";
    }
    
    /**
     * Upon icon insertion success, hide the footer
     */
    function onSuccess() {
      domFooter.style.display = "none";
    }

    
  </script>
</body>
</html>
